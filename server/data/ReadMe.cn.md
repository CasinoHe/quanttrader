# 数据模块的实现

数据模块功能需求是能够获取历史数据以及实时交易数据，并且能够传递给例如ta-lib等第三方库，进行指标的计算。

## 细节需求

1. 数据存储、压缩、操作的需求。进行数据回测和预测需要比较快的数据获取，app回测可能会重启，为了减少从网络获取数据的时间数据需要存储，由于硬盘大小的限制，数据需要能够压缩，并且能够方便的预览以及删除不需要的缓存数据。
2. 数据变更的需求。由于在计算策略和回测中，我们会进行一定程度的预测，预测的计算过程会有数据产生，这部分数据并不是真实数据，测试后会被回退。这部分数据可能会继续回测，这部分数据也需要存盘、压缩以及能够被修改。
3. 获取数据。能够获取OHLC类型的历史数据以及实时数据，也能够获取tick交易的实时数据。
4. 数据采样。能够把短期的数据重新采样成长期数据，例如日数据能够合并成周数据，tick数据能够合并成秒数据等。
5. 通用性要求。能够发送给例如ta-lib这样的的第三方库进行指标的计算。
6. 多线程要求。能够支持多线程的指标计算，数据来源是单线程记录。
7. 使用便捷性要求。能够通过index的方式快速的获取最近的数据，上一次最近的数据。

## 实现分层

为了实现总体的需求，数据模块需要分成三层。

1. 底层数据库模块，底层可以采取mmap，文件，压缩，数据库等各种方式把数据存下来，并且能够进行操作，能够压缩。
2. 中层是一个胶水层，能够从各种接口获取数据，例如IB GateWay，Yahoo Finance以及本地数据库，也可以把数据发给上层，有内存数据，也有临时存盘数据。
3. 上层是一个内存数据，存储所有实时数据，能够直接发给ta-lib等进行指标计算。
